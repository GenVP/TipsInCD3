# TipsInCD3 Контекстная подсказка в 1С КД3

## Использование оформления кода:

1. Подключить расширение. Отключить у расширения безопасный режим, так как расширение меняет типовые модули и формы.
2. Установить галочку "Использовать редактор кода" в "Администрирование" - "Настройки контекстной подсказки".

### Как работает:

- Поля обработчиков заменяются на поля HTML документов с оформлением кода через [bsl_console](https://github.com/salexdv/bsl_console) и работающей подсказкой

## Использования контекстной подсказки:

1. Подключить расширение. Отключить у расширения безопасный режим, так как расширение работает с файлами. Если в настройках указан парсер "Регулярками" и используется внешняя компонента [RegEx1CAddin](https://github.com/alexkmbk/RegEx1CAddin), то будет задаваться вопрос по ее установке.
2. Настроить параметры подсказки в "Администрирование" - "Настройки контекстной подсказки".
3. В "Конфигурации" -> "Релизы" настроить использование контекстной подсказки конкретной конфигурации (описано ниже).

### Как работает:

- В зависимости от настроек конфигурации в Релизе используются разные источники метаданных подсказки.
- Если в состав конвертаций входит несколько конфигураций (релизов), то на страницах обработчиков появляется группа "Контекстная подсказка" в которой можно выбрать нужную конфигурацию.
- Если для конфигурации указано расписание и каталог для загрузки из исходных кодов, то подсказка выполняется по файлам исходных кодов, иначе используются загруженные в 1С метаданные в справочниках "Объекты", "Свойства", "Значения".

## Настройки

### Настройки редактора кода

- Задются в "Администрирование" - "Настройки контекстной подсказки".
- Можно загрузить новую версию консоли кода из dev-исходников GitHub. Для linux версию bsl-console можно загрузить только из макета (так как ее нужно упаковать с учетом изменений). 
- Можно задать способ разбора исходников модулей 1С:
    - Регулярками - либо новын методы 1С для регулярных выражений (платформа старше 8.23), либо внешняя компонента [RegEx1CAddin](https://github.com/alexkmbk/RegEx1CAddin) (устанавливается из макета расширения)
    - Кодом 1С - используетс парсер только кодом 1С из проекта [bsl-parser](https://github.com/bia-technologies/bsl-parser)

### Настройки получения данных подсказки

- Указывается в релизах в поле "Место хранения контекстной подсказки"
    - "Не использовать" - контекстная подсказка только по загруженным типовым объектам метаданных (без модулей, обработок и т.д.)
    - "Не хранить" - в форме релиза должна быть установлена галочка загрузки по расписанию (можно поставить конечную дату в прошлом) и указаны каталоги исходных кодов. В этом случае исходники анализируются в момент вызова контекстной подсказки. Это можно потребовать некоторое время при первом вызове, но потом данные кешируются в РС "Безопасное хранилище данных".

## Измененная обработка "Загрузка структуры конфигурации из файлов XML/EDT (Многопоточно) (КД3)":

- Модифицированная версия типовой обработки с возможностью загрузки объектов метаданных в несколько потоков. Исправлены некоторые ошибки при загрузки из исходников EDT (помечены комментариями "КД3 FIX")
- В клиент-серверном варианте возможна загрузка метаданных объектов параллельно до 8 потоков (количество потоков выбирается в настройках обработки), в файловом варианте всегда выполняется загрузка в 1 поток
- Добавлен режим загрузки на серерве (вибирается на форме обработки). В режиме "На серерве" копирование исходных файлов конфигурации и расширений выполняется на сервере (как при загрузке регламентным задание).
- Можно указать признак типовой загрузки (если загрузкав в 1 поток и не загружаются методжы модулей). В этом случае загрузка соответствует типовой обработке "ЗагрузкаСтруктурыКонфигурацииИзФайловXML", но с возможностью загрузки на сервере и возможностью прервать загрузку.
- Добавлен детальный прогресс загрузки по объектам
- Загружаются данные для контекстной подсказки (общие модули, методы общих модулей / модулей объектов)

### Разовая загрузка из исходных кодов

1. С помощью модифицированной обработки "Загрузка структуры конфигурации из файлов XML/EDT многопоточно (КД3)" загрузить метаданные и их индексы.
Сохраняются процедуры/функции глобальных и неглобальных общих модулей, список общих модулей, процедуры/функции модулей объекта и модулей менеджера объекта.
Варианты хранения индексов:

- "Не использовать", если не нужно загружать/хранить дополнительные метаданные контекстной подсказки.
- "В каталоге", если индексы должны сохраняться в выбранном каталоге. Для клиент-серверной ИБ конвертации каталог должен быть доступен с сервера 1С.
- "В информационной базе", если индексы должны сохраняться в ИБ конвертации в РС "Безопасное хранилище данных". Ключи метаданных имеют вид "КД3<GUID конфигурации>_<Имя индекса>"
- "Не хранить", если индексы глобального контекста не сохраняются, а всегда заполняются в момент вызова подсказки.

## Замечания:

- Выгрузка исходников на платформе 8.3.26
- Версия bsl_console для Window в макете загружена из исходников GitHub 2025.11.08. Для Linux старая версия 2022.03.22
- Используется модифицированная версия bsl_console (добавлены два метода). Изменения можно посмотреть здесь: https://github.com/GenVP/bsl_console. Методы добавляются в код bsl_console в момент распаковки исходников.
- Проверялось на 1С:Предприятие 8.3 (8.3.26), Конвертация данных 3.1.5.36

## Используемые инструменты:

- В качестве редактара кода используется замечательная [bsl_console](https://github.com/salexdv/bsl_console) от [salexdv](https://github.com/salexdv)
- При анализе модулей (настройка "регулярками", до платформы 1С 8.3.23) используется отличная внешняя NativeAPI компонента [RegEx1CAddin](https://github.com/alexkmbk/RegEx1CAddin)
- При анализе модулей (настройка "кодом 1С") используется код из проекта [bsl-parser](https://github.com/bia-technologies/bsl-parser)
- Вдохновение для дальнейшей реализации взято от мощной подсистемы ["Инструменты разработчика"](https://github.com/tormozit/RDT1C)

