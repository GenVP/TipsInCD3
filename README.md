# TipsInCD3

## Контекстная подсказка в 1С КД3

Выражаю благодарность [salexdv](https://github.com/salexdv) с его разработкой [bsl_console](https://github.com/salexdv/bsl_console) как первому разработчику адаптировавшему редактор кода 1С для управляемого приложения.

Порядок использования:

### Загрузка из исходных кодов регламентным заданием ###
1. Настроить расписание загрузки из исходных кодов нужной конфигурации в справочнике "Релизы"
2. Указать в справочнике "Релизы" для нужной конфигурации место хранения индексов метаданных.
Сохраняется только глобальный контекст (процедуры/функции глобальных модулей и список общих неглобальных модулей).
Для неглобального контекста индексы заполняются в момент вызова подсказки и сохраняются только в клиентском кэше на время сеанса ИБ.
Варианты хранения индексов:
- "Не хранить", если для этой конфигурации нужно отключить контекстную подсказку.
- "В каталоге", если индексы должны сохраняться в выбранном каталоге.
Для клиент-серверной ИБ конвертации каталог должен быть доступен с сервера 1С.
- "В информационной базе", если индексы должны сохраняться в ИБ конвертации в РС "Безопасное хранилище данных".
Ключи метаданных имеют вид "КД3<GUID конфигурации>_<Имя индекса>"
- "Не сохранять", если индексы глобального контекста не сохраняются, а всегда заполняются в момент вызова подсказки. 
Для больших конфигураций можент приводить к замедлению активизации элементов обработчиков.
3. Дождаться выполнения регламентного задания для этой конфигурации или загрузить метаданные с помощью измененной обработки "Загрузка структуры конфигурации из файлов XML/EDT (КД3)".
### Разовая загрузка из исходных кодов ###
1. Отключить расписание загрузки из исходных кодов нужной конфигурации в справочнике "Релизы"
2. С помощью модифицированной обработки "Загрузка структуры конфигурации из файлов XML/EDT (КД3)" загрузить метаданные и их индексы.
Сохраняются процедуры/функции глобальных и неглобальных общих модулей, список общих модулей, процедуры/функции модулей объекта и модулей менеджера объекта.
Варианты хранения индексов:
- "Не хранить", если для этой конфигурации нужно отключить контекстную подсказку.
- "В каталоге", если индексы должны сохраняться в выбранном каталоге.
Для клиент-серверной ИБ конвертации каталог должен быть доступен с сервера 1С.
- "В информационной базе", если индексы должны сохраняться в ИБ конвертации в РС "Безопасное хранилище данных".
Ключи метаданных имеют вид "КД3<GUID конфигурации>_<Имя индекса>"

### Загрузка из отдельной информационной базы (В ПРОЦЕССЕ РАЗРАБОТКИ) ###
1. Выгрузить из информационной базы метаданные и их индексы (процедуры/функции модулей) с помощью измененной обработки КД3_MD83Exp.epf.
При выгрузке указать необходимость выгрузки процедур/функций модулей и дополнительных объектов (отчеты, обработки и т.д.).
2. Загрузить метаданные в конфигурацию "Конвертация данных 3" с помощью измененной обработки "Загрузка структуры конфигурации (КД3)".
При загрузке указать место хранения индексов метаданных.
Варианты хранения индексов:
- "Не хранить", если для этой конфигурации нужно отключить контекстную подсказку.
- "В каталоге", если индексы должны сохраняться в выбранном каталоге.
Для клиент-серверной ИБ конвертации каталог должен быть доступен с сервера 1С.
- "В информационной базе", если индексы должны сохраняться в ИБ конвертации в РС "Безопасное хранилище данных".
Ключи метаданных имеют вид "КД3<GUID конфигурации>_<Имя индекса>"

Как работает:

- Поля обработчиков заменяются на поля HTML документов с работающей подсказкой
- Если в состав конвертаций входит несколько конфигураций (релизов), то на страницах обработчиков появляется группа "Контекстная подсказка" в которой можно выбрать нужную конфигурацию
- Если для конфигурации указано расписание и каталог для загрузки из исходных кодов, то подсказка выполняется по файлам исходных кодов, иначе используются загруженные в 1С метаданные в справочниках "Объекты", "Свойства", "Значения"

### Измененная обработка "Загрузка структуры конфигурации из файлов XML/EDT (КД3)": ###
- Добавлен грубый прогресс вывода
- Добавлен режим загрузки на серерве. В этом случае не выполняется передача файлов с клиента на сервер. Особенно удобно при загрузке больших конфигураций в файловой базе конвертации
- Добавлена загрузка метаданных регламентным заданием
- Добавлена загрузка индексов контекстной подсказки

Замечания:

- Используется модифицированная версия bsl_console (добавлены два метода). Изменения можно посмотреть здесь: https://github.com/GenVP/bsl_console
- Проверялось на тонком клиенте 1С:Предприятие 8.3 (8.3.18.1698)
